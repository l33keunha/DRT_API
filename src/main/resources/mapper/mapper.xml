<?xml version="1.0" encoding="EUC-KR"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ybs.api.boot.service.impl.ApiMapper">

    <select id="getSttn" parameterType="Map" resultType="Map">
        SELECT *
        FROM
            DRP_STTN
        WHERE 1=1
          AND RUN_AREA_CD= #{RUN_AREA_CD}
          ORDER BY NODE_ID 
    </select>

    <select id="getSche"  parameterType="Map" resultType="Map">
        SELECT
            SDATE
             ,ST_TM
             ,AREA_NM
             ,AREA_CD
             ,RUN_AREA_NM
             ,RUN_AREA_CD
             ,RUN_ORDER
             ,ROUTE_ID
             ,ROUTE_NM
             ,ROUTE_NMA
             ,ROUTE_DIR
             ,PLAT_NUM
             ,DRIVER_NM
             ,F_NODE_NM
             ,T_NODE_NM
             ,F_NODE_ID
             ,T_NODE_ID
             ,MAX_TM
             ,MAX_USER
        FROM
            DRP_ROUTE_SCHE
        WHERE 1=1
          AND SDATE = TO_DATE(#{SDATE}, 'YYYYMMDD')
          AND ST_TM LIKE #{ST_TM}||'%'
          AND ROUTE_ID =  #{ROUTE_ID}
    </select>

    <insert id="setUserMast" parameterType="map">
        INSERT INTO DRP_USER_MAST VALUES
            (
                CONCAT(CONCAT(CONCAT(TO_CHAR(SYSDATE,'YYYYMMDD'), TO_CHAR(SYSDATE,'HH24MMSS')),'U'), LPAD(USER_NO.NEXTVAL,3,0)),
                TO_DATE(#{REV_DATE}, 'YYYYMMDD'),
                #{REV_TM},
                TO_DATE(#{SDATE}, 'YYYYMMDD'),
                #{ST_TM},
                #{AREA_NM},
                #{AREA_CD},
                #{RUN_AREA_NM},
                #{RUN_AREA_CD},
                #{RUN_ORDER},
                #{ROUTE_ID},
                #{ROUTE_NM},
                #{ROUTE_NMA},
                #{ROUTE_DIR},
                #{PLAT_NUM},
                #{STTN_IN_NM},
                #{STTN_OUT_NM},
                #{STTN_IN_ID},
                #{STTN_OUT_ID},
                #{MAX_SEAT},
                #{TOTAL_DIST},
                #{TOTAL_TM},
                #{USER_CNT},
                #{USER_NM},
                #{USER_PHONE},
                #{REV_TYPE}
            )
    </insert>

    <select id="getUserMast" parameterType="map" resultType="map">
        SELECT *
        FROM DRP_USER_MAST
        WHERE 1=1
          AND ROUTE_ID =  #{ROUTE_ID}
          AND ROUTE_DIR = #{ROUTE_DIR}
          AND SDATE = TO_DATE(#{SDATE}, 'YYYYMMDD')
          AND ST_TM LIKE #{ST_TM}||'%'
    </select>

    <insert id="setHist" parameterType="map">
        INSERT INTO DRP_ROUTE_HIST VALUES
            (
                TO_DATE(#{SDATE}, 'YYYYMMDD'),
                #{ST_TM},
                #{AREA_NM},
                #{AREA_CD},
                #{RUN_AREA_NM},
                #{RUN_AREA_CD},
                #{RUN_ORDER},
                #{ROUTE_ID},
                #{ROUTE_NM},
                #{ROUTE_NMA},
                #{ROUTE_DIR},
                #{PLAT_NUM},
                #{DRIVER_NM},
                #{F_NODE_NM},
                #{T_NODE_NM},
                #{F_NODE_ID},
                #{T_NODE_ID},
                #{TOTAL_DIST},
                #{TOTAL_TM},
                #{USER_CNT},
                #{BOARDING_STATUS}
            )
    </insert>

    <insert id="setPath" parameterType="ybs.api.boot.service.xmlVO">
        <foreach collection="list" item="vo" separator=" " open="INSERT ALL" close ="SELECT * FROM DUAL">
            INTO DRP_PATH VALUES(
                CONCAT(CONCAT(CONCAT(TO_CHAR(SYSDATE,'YYYYMMDD'), TO_CHAR(SYSDATE,'HH24MMSS')),'S'), LPAD(SCHE_NO.NEXTVAL,3,0)),
                1,
                NULL,
                NULL,
                NULL,
                #{vo.index, jdbcType=INTEGER},
                #{vo.name, jdbcType=VARCHAR},
                #{vo.nodeType, jdbcType=VARCHAR},
                #{vo.point, jdbcType=VARCHAR},
                #{vo.lineString, jdbcType=VARCHAR},
                #{vo.coordinates, jdbcType=VARCHAR},
                #{vo.turnType, jdbcType=VARCHAR},
                #{vo.pointIndex, jdbcType=INTEGER},
                #{vo.pointType, jdbcType=VARCHAR},
                #{vo.lineIndex, jdbcType=INTEGER},
                #{vo.distance, jdbcType=INTEGER},
                #{vo.time, jdbcType=INTEGER},
                #{vo.roadType, jdbcType=VARCHAR},
                #{vo.facilityType, jdbcType=VARCHAR},
                #{vo.linkId, jdbcType=VARCHAR},
                #{vo.costdstn, jdbcType=VARCHAR}
            )
        </foreach>
    </insert>
</mapper>